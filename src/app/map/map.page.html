<ion-content [scrollY]="true">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content">
      <h1>Smart City Map</h1>
      <p>Monitoring kota Surakarta (Solo)</p>
    </div>
  </div>

  <!-- Map Container -->
  <div class="map-section">
    <ion-card class="map-card">
      <ion-card-content>
        <div class="map-container">
          <!-- Tangram Map -->
          <div id="map"></div>
          
          <!-- Map Legend -->
          <div class="map-legend">
            <div class="legend-title">SeismoSens Network</div>
            <div class="legend-item" *ngFor="let item of legendItems">
              <div class="legend-dot" [style.background]="item.color"></div>
              <span>{{ item.label }} ({{ item.count }})</span>
            </div>
          </div>

          <!-- Map Controls -->
          <div class="map-controls">
            <ion-fab-button size="small" color="light" class="map-control-btn" (click)="zoomIn()">
              <ion-icon name="add"></ion-icon>
            </ion-fab-button>
            <ion-fab-button size="small" color="light" class="map-control-btn" (click)="zoomOut()">
              <ion-icon name="remove"></ion-icon>
            </ion-fab-button>
            <ion-fab-button size="small" color="light" class="map-control-btn" (click)="centerMap()">
              <ion-icon name="locate"></ion-icon>
            </ion-fab-button>
            <ion-fab-button size="small" color="light" class="map-control-btn" (click)="fitToMarkers()">
              <ion-icon name="expand"></ion-icon>
            </ion-fab-button>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Filter Controls -->
  <ion-card class="filter-card">
    <ion-card-content>
      <div class="filter-title">Filter Peta</div>
      <div class="filter-buttons">
        <ion-button
          *ngFor="let filter of filterOptions"
          [fill]="filter.active ? 'solid' : 'outline'"
          [color]="filter.active ? 'primary' : 'medium'"
          size="small"
          class="filter-btn"
          (click)="filterMarkers(filter.id)"
        >
          {{ filter.label }}
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Statistics Section -->
  <div class="content-section">
    <div class="section-title">Perangkat di Surakarta</div>
    <div class="stats-grid">
      <ion-card class="stat-card">
        <ion-card-content>
          <div class="stat-value success">{{ getTotalActive() }}</div>
          <div class="stat-label">Total Aktif</div>
        </ion-card-content>
      </ion-card>
      <ion-card class="stat-card">
        <ion-card-content>
          <div class="stat-value primary">{{ getCityUptime() }}</div>
          <div class="stat-label">Uptime Kota</div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Public Locations -->
    <div class="section-subtitle">Lokasi Publik</div>
    <div class="location-card" 
         *ngFor="let location of getPublicLocations()" 
         [ngClass]="location.status"
         (click)="showLocationDetail(location.name)">
      <ion-card-content>
        <div class="location-header">
          <div class="location-info">
            <h3>{{ location.name }}</h3>
            <p>{{ location.distance || '0.8 km' }} • {{ location.category }} • {{ location.address }}</p>
          </div>
          <div class="location-status" [ngClass]="location.status">
            {{ getStatusText(location) }}
          </div>
        </div>
      </ion-card-content>
    </div>

    <!-- User Devices Section -->
    <div class="section-subtitle user-devices-section">Perangkat Anda di Solo</div>
    <div class="device-card user-device" 
         *ngFor="let device of getUserDevices()" 
         (click)="showDeviceDetail(device.id)">
      <ion-card-content>
        <div class="device-header">
          <div class="device-info">
            <h3>{{ device.id }}</h3>
            <p>{{ device.category }} • {{ device.address }}</p>
          </div>
          <div class="device-status user">
            {{ device.health && device.health > 0 ? 'Milik Anda' : 'Milik Anda' }}
          </div>
        </div>
        <div class="device-metrics">
          <div class="metric">
            <div class="metric-value" [ngClass]="{ 'offline': !device.health || device.health === 0 }">
              {{ device.health || 0 }}%
            </div>
            <div class="metric-label">Health</div>
          </div>
          <div class="metric">
            <div class="metric-value">
              {{ device.health && device.health > 0 ? 'Online' : 'Offline' }}
            </div>
            <div class="metric-label">Status</div>
          </div>
        </div>
      </ion-card-content>
    </div>
  </div>
</ion-content>